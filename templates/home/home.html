{% extends 'base.html'%}
{% load static %}
{% load leaflet_tags %}




{% block map_content %}
<style>
    .leaflet-container {

        width: 100%;
        height: 100%;
    }

    #specialbigmap {
        height: 600px;
    }

    /* Resize the "display_raw" textbox */
    .django-leaflet-raw-textarea {
        width: 100%;
    }

    .leaflet-marker-icon img {
        border: 0;
    }

    #map {
        height: 100%;
        width: 100%;
    }
</style>

<!-- stylesheets -->
{% leaflet_js %}
{% leaflet_css %}

<link href="{% static 'fontawesomefree/css/all.min.css' %}" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="http://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css">

{% leaflet_map "main" %}

<div id="sidebar" class="leaflet-sidebar">
    <!-- nav tabs -->
    <div class="leaflet-sidebar-tabs">
        <!-- top aligned tabs -->
        <ul role="tablist">
            <li><a href="#home" role="tab"><i class="fa fa-home active"></i></a></li>
            <li><a href="#autopan" role="tab"><i class="fa fa-book-open"></i></a></li>
        </ul>


    </div>

    <!-- panel content -->
    <div class="leaflet-sidebar-content">
        <div class="leaflet-sidebar-pane" id="home">
            <h1 class="leaflet-sidebar-header">
                Home
                <span class="leaflet-sidebar-close"><i class="fa fa-caret-left"></i></span>
            </h1>

            <p>A responsive sidebar for the mapping library <a href="https://leafletjs.com/">Leaflet</a>.</p>
            <p>Compatible with version 0.7 and 1.x (tested up to 1.6.0)</p>
            <p><b>Select the other panes for a showcase of each feature.</b></p>

            <h2>More examples</h2>
            <ul>
                <li><a href="./position-right.html">Right aligned</a></li>
                <li><a href="./halfheight.html">The sidebar adapts to map container size</a></li>
                <li><a href="./leaflet-0.7.html">Proof that it works with leaflet 0.7</a></li>
            </ul>

            <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor
                invidunt
                ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores
                et
                ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum
                dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore
                magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet
                clita
                kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
            <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor
                invidunt
                ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores
                et
                ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum
                dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore
                magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet
                clita
                kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
            <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor
                invidunt
                ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores
                et
                ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum
                dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore
                magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet
                clita
                kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
            <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor
                invidunt
                ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores
                et
                ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum
                dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore
                magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet
                clita
                kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
        </div>

        <div class="leaflet-sidebar-pane" id="autopan">
            <h1 id="name" class="leaflet-sidebar-header">
                Details
                <span class="leaflet-sidebar-close"><i class="fa fa-caret-left"></i></span>
            </h1>
            <div>
                <h6>Year started:</h6>
                <p id="year_started"></p>
            </div>
            <div>
                <h6>Description: </h6>
                <p id="description"></p>
            </div>
            <div>
                <h6>Fee: </h6>
                <p id="fee"></p>
            </div>
            <div>
                <h6>Contact: </h6>
                <p id="contact"></p>
            </div>
            <div>
                <h6>Phone: </h6>
                <p id="phone"></p>
            </div>
            <div>
                <h6>Email: </h6>
                <p id="email"></p>
            </div>
            <div>
                <h6>Access Road: </h6>
                <p id="access_road"></p>
            </div>
        </div>

        <!-- <div id="carouselExampleSlidesOnly" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img id="image1" src=`${selected.image}` class="d-block w-100" alt="First Image">
            </div>
            <div class="carousel-item active">
                <img id="image1" src=`${selected.image_2}` class="d-block w-100" alt="First Image">
            </div>

        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleFade" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleFade" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    <div>
        <h6>Year started:</h6>
        <p id="year_started"></p>
    </div>
    <div>
        <h6>Description: </h6>
        <p id="description"></p>
    </div>
    <div>
        <h6>Fee: </h6>
        <p id="fee"></p>
    </div>
    <div>
        <h6>Contact: </h6>
        <p id="contact"></p>
    </div>
    <div>
        <h6>Email: </h6>
        <p id="email"></p>
    </div>
    <div>
        <h6>Access Road: </h6>
        <p id="access_road"></p>
    </div> -->

    </div>



    <script>
        var dataurl = '{% url "get_sites" %}';
        // var data = new L.GeoJSON.AJAX(dataurl)
        var sidebarDiv = document.getElementById('sidebar');
        var selected;

        var siteMarker = L.ExtraMarkers.icon({
            icon: 'fa-monument',
            markerColor: 'green',
            shape: 'square',
            prefix: 'fa'
        })

        window.addEventListener("map:init", function (event) {
            var map = event.detail.map;
            var sidebar = L.control.sidebar('sidebar', {
                autopan: false,
                container: 'sidebar',
                closeButton: true,
                position: 'right'
            }).addTo(map).open('home');

            L.control.locate({
                flyTo: true
            }).addTo(map);

            // sidebar
            //     .addPanel({
            //         id: 'js-api',
            //         tab: '<i class="fa fa-gear"></i>',
            //         title: 'JS API',
            //         pane: '<p>The Javascript API allows to dynamically create or modify the panel state.<p/><p><button onclick="sidebar.enablePanel(\'mail\')">enable mails panel</button><button onclick="sidebar.disablePanel(\'mail\')">disable mails panel</button></p><p><button onclick="addUser()">add user</button></b>',
            //     })
            //     // add a tab with a click callback, initially disabled
            //     .addPanel({
            //         id: 'mail',
            //         tab: '<i class="fa fa-envelope"></i>',
            //         title: 'Messages',
            //         button: function () { alert('opened via JS callback') },
            //         disabled: true,
            //     })

            // be notified when a panel is opened
            sidebar.on('content', function (ev) {
                switch (ev.id) {
                    case 'autopan':
                        sidebar.options.autopan = true;
                        break;
                    default:
                        sidebar.options.autopan = false;
                }
            });




            // var markers = L.markerClusterGroup();
            // Download GeoJSON data with Ajax
            // map.addControl(sidebar);
            fetch(dataurl)
                .then(function (resp) {
                    return resp.json();
                })
                .then(function (data) {
                    points = L.geoJson(data)
                    L.geoJson(data, {
                        onEachFeature: function onEachFeature(feature, layer) {
                            var props = feature.properties;
                            var content = `<h3>${props.location_code}</h3><p>${props.location_code}</p>`;
                            layer.setIcon(siteMarker);
                            // layer.bindPopup(content);
                            layer.on({
                                click: function () {
                                    console.log(props)
                                    document.getElementById('name').textContent = props.name;
                                    document.getElementById('year_started').textContent = props.year_of_inception;
                                    document.getElementById('description').textContent = props.brief_history;
                                    document.getElementById('contact').textContent = props.contact_name;
                                    document.getElementById('fee').textContent = props.fee;
                                    document.getElementById('phone').textContent = props.phone;
                                    document.getElementById('email').textContent = props.email;
                                    document.getElementById('access_road').textContent = props.email;

                                }
                            })

                        }
                    }).addTo(map)
                    map.fitBounds(points.getBounds());


                });
        });
    </script>

    {% endblock map_content %}